{"version":3,"sources":["app.js"],"names":["Base64Binary","_keyStr","decodeArrayBuffer","base64String","bytes","Math","ceil","length","arrayBuffer","ArrayBuffer","decode","lkey1","indexOf","charAt","lkey2","chr1","chr2","chr3","enc1","enc2","enc3","enc4","i","j","uarray","Uint8Array","replace","MIDI","window","Soundfont","Context","contextMethods","proto","prototype","instance","sourceProto","Object","getPrototypeOf","createBufferSource","start","noteOn","when","offset","duration","arguments","Error","buffer","noteGrainOn","stop","noteOff","forEach","names","name","pop","AudioContext","getMono","channelId","channel","channels","setMono","truthy","delay","isFinite","setTimeout","value","keyToNote","A0","C8","number2key","n","octave","res","number","program","pitchBend","mute","mono","omni","solo","API","FORMAT","loadPlugin","opts","Promise","resolve","context","instrument","connect","sendRequest","then","catch","e","console","error","programId","reject","fetch","script","document","createElement","language","type","text","body","appendChild","audioContext","midi","WebAudio","api","midiAudioContext","sources","masterVolume","audioBuffers","send","data","setController","setVolume","volume","bend","noteId","velocity","warn","bufferId","log","currentTime","source","gain","destination","playbackRate","gainNode","createGain","min","max","linearRampToValueAtTime","key","keyURLs","notes","push","waitForEnd","bufferPending","requestAudio","soundfont","index","keyURL","loadAudio","id","isLoaded","soundfonts","spec","url","base64","split","decodeAudioData"],"mappings":"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","file":"b2b3fa487330c5902ea92b4863c2371b.map","sourcesContent":["// Gets a URL referencing the asset.\nimport tubaAudioURL from './tuba-ogg.dat';\n\nvar Base64Binary = {\n\t_keyStr : \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n\n\t/* will return a  Uint8Array type */\n\tdecodeArrayBuffer: function(base64String) {\n\t\t// TODO WFH What is this?\n\t\t// Seems like we're estimating the size of the buffer?\n\t\tlet bytes = Math.ceil((3 * base64String.length) / 4.0);\n\n\t\tlet arrayBuffer = new ArrayBuffer(bytes);\n\n\t\tthis.decode(base64String, arrayBuffer, bytes);\n\n\t\treturn arrayBuffer;\n\t},\n\n\tdecode: function(base64String, arrayBuffer, bytes) {\n\t\t//get last chars to see if are valid\n\t\tvar lkey1 = this._keyStr.indexOf(base64String.charAt(base64String.length-1));\n\t\tvar lkey2 = this._keyStr.indexOf(base64String.charAt(base64String.length-1));\n\n\t\tif (lkey1 == 64) bytes--; //padding chars, so skip\n\t\tif (lkey2 == 64) bytes--; //padding chars, so skip\n\n\t\tvar chr1, chr2, chr3;\n\t\tvar enc1, enc2, enc3, enc4;\n\t\tvar i = 0;\n\t\tvar j = 0;\n\n\t\tlet uarray = new Uint8Array(arrayBuffer);\n\n\t\tbase64String = base64String.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\n\t\t// TODO WFH Ah, this may explain our 3 * x / 4\n\t\tfor (i=0; i<bytes; i+=3) {\n\t\t\t//get the 3 octects in 4 ascii chars\n\t\t\tenc1 = this._keyStr.indexOf(base64String.charAt(j++));\n\t\t\tenc2 = this._keyStr.indexOf(base64String.charAt(j++));\n\t\t\tenc3 = this._keyStr.indexOf(base64String.charAt(j++));\n\t\t\tenc4 = this._keyStr.indexOf(base64String.charAt(j++));\n\n\t\t\tchr1 = (enc1 << 2) | (enc2 >> 4);\n\t\t\tchr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n\t\t\tchr3 = ((enc3 & 3) << 6) | enc4;\n\n\t\t\tuarray[i] = chr1;\n\t\t\tif (enc3 != 64) uarray[i+1] = chr2;\n\t\t\tif (enc4 != 64) uarray[i+2] = chr3;\n\t\t}\n\n\t\treturn uarray;\n\t}\n};\n\nlet MIDI = window.MIDI = { Soundfont: {} };\n\n(function (Context) {\n\tvar contextMethods = [\n\t\t[\"createGainNode\", \"createGain\"],\n\t\t[\"createDelayNode\", \"createDelay\"],\n\t\t[\"createJavaScriptNode\", \"createScriptProcessor\"]\n\t];\n\n\tlet proto = Context.prototype;\n\tlet instance = new Context();\n\tlet sourceProto = Object.getPrototypeOf(instance.createBufferSource());\n\n\tif (typeof sourceProto.start !== 'function') {\n\t\tif (typeof sourceProto.noteOn === 'function') {\n\t\t\tsourceProto.start = function (when, offset, duration) {\n\t\t\t\tswitch (arguments.length) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tthrow new Error(\"Not enough arguments.\");\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tthis.noteOn(when);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tif (this.buffer) {\n\t\t\t\t\t\t\tthis.noteGrainOn(when, offset, this.buffer.duration - offset);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"Missing AudioBuffer\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tthis.noteGrainOn(when, offset, duration);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\tif (typeof sourceProto.noteOn !== 'function') {\n\t\tsourceProto.noteOn = sourceProto.start;\n\t}\n\n\tif (typeof sourceProto.noteGrainOn !== 'function') {\n\t\tsourceProto.noteGrainOn = sourceProto.start;\n\t}\n\n\tif (typeof sourceProto.stop !== 'function') {\n\t\tsourceProto.stop = sourceProto.noteOff;\n\t}\n\n\tif (typeof sourceProto.noteOff !== 'function') {\n\t\tsourceProto.noteOff = sourceProto.stop;\n\t}\n\n\tcontextMethods.forEach(function (names) {\n\t\twhile (names.length) {\n\t\t\tlet name = names.pop();\n\t\t\tthis[names.pop()] = this[name];\n\t\t}\n\t}, proto);\n})(window.AudioContext);\n\nMIDI.getMono = function(channelId) {\n\tvar channel = channels[channelId];\n\tif (channel) {\n\t\treturn channel['mono'];\n\t}\n};\n\nMIDI.setMono = function(channelId, truthy, delay) {\n\tif (!isFinite(truthy)) {\n\t\treturn;\n\t}\n\n\tvar channel = channels[channelId];\n\tif (channel) {\n\t\tif (delay) {\n\t\t\tsetTimeout(function() { //- is there a better option?\n\t\t\t\tchannel['mono'] = value;\n\t\t\t}, delay);\n\t\t} else {\n\t\t\tchannel['mono'] = value;\n\t\t}\n\t}\n};\n\nMIDI.keyToNote = {}; // C8  == 108\n\n(function() {\n\tvar A0 = 0x15; // first note\n\tvar C8 = 0x6C; // last note\n\tvar number2key = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];\n\tfor (var n = A0; n <= C8; n++) {\n\t\tvar octave = (n - 12) / 12 >> 0;\n\t\tvar name = number2key[n % 12] + octave;\n\t\tMIDI.keyToNote[name] = n;\n\t}\n})();\n\nMIDI.channels = (function() {\n\tvar res = {};\n\tfor (var number = 0; number <= 15; number++) {\n\t\tres[number] = {\n\t\t\tnumber: number,\n\t\t\tprogram: number,\n\t\t\tpitchBend: 0,\n\t\t\tmute: false,\n\t\t\tmono: false,\n\t\t\tomni: false,\n\t\t\tsolo: false\n\t\t};\n\t}\n\treturn res;\n})();\n\nconst API = 'webaudio'; // 'webmidi', 'audiotag'\nconst FORMAT = 'ogg';\n\nMIDI.loadPlugin = function(opts = {}) {\n\treturn new Promise((resolve) => {\n\t\tconst context = 'WebAudio';\n\n\t\tif (MIDI.Soundfont[opts.instrument]) {\n\t\t\tMIDI[context].connect(opts);\n\n\t\t\treturn resolve();\n\t\t}\n\n\t\tsendRequest(opts.instrument, FORMAT).then(() => {\n\t\t\tMIDI[context].connect(opts);\n\t\t}).catch((e) => {\n\t\t\tconsole.error(e);\n\t\t});\n\n\t\tresolve();\n\t});\n};\n\nfunction sendRequest(programId) {\n\treturn new Promise((resolve, reject) => {\n\t\tfetch(tubaAudioURL).then(function (res) {\n\t\t\tlet script = document.createElement('script');\n\t\t\tscript.language = 'javascript';\n\t\t\tscript.type = 'text/javascript';\n\t\t\tres.text().then((text) => {\n\t\t\t\tscript.text = text;\n\t\t\t\tdocument.body.appendChild(script);\n\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}).catch(function (e) {\n\t\t\treject();\n\t\t});\n\t});\n};\n\n(function() {\n\tvar audioContext = null; // new AudioContext();\n\tvar midi = MIDI.WebAudio = {api: 'webaudio'};\n\tvar midiAudioContext; // audio context\n\tvar sources = {};\n\tvar masterVolume = 127;\n\tvar audioBuffers = {};\n\n\tmidi.audioBuffers = audioBuffers;\n\n\tmidi.send = function(data, delay) { };\n\n\tmidi.setController = function(channelId, type, value, delay) { };\n\n\tmidi.setVolume = function(channelId, volume, delay) {\n\t\tif (delay) {\n\t\t\tsetTimeout(function() {\n\t\t\t\tmasterVolume = volume;\n\t\t\t}, delay * 1000);\n\t\t} else {\n\t\t\tmasterVolume = volume;\n\t\t}\n\t};\n\n\tmidi.pitchBend = function(channelId, bend, delay) {\n\t\tvar channel = MIDI.channels[channelId];\n\t\tif (channel) {\n\t\t\tif (delay) {\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tchannel.pitchBend = bend;\n\t\t\t\t}, delay);\n\t\t\t} else {\n\t\t\t\tchannel.pitchBend = bend;\n\t\t\t}\n\t\t}\n\t};\n\n\tmidi.noteOn = function(channelId, noteId, velocity, delay) {\n\t\tdelay = delay || 0;\n\n\t\t/// check whether the note exists\n\t\tvar channel = MIDI.channels[channelId];\n\t\tvar instrument = channel.program;\n\n\t\tconsole.warn('overriding instrument id');\n\t\tinstrument = 58;\n\n\t\tvar bufferId = instrument + 'x' + noteId;\n\n\t\tconsole.log(`bufferId: ${bufferId}`);\n\n\t\tvar buffer = audioBuffers[bufferId];\n\t\tif (!buffer) {\n\t\t\tconsole.error('no buffer', arguments);\n\n\t\t\treturn;\n\t\t}\n\n\t\t// convert relative delay to absolute delay\n\t\tif (delay < midiAudioContext.currentTime) {\n\t\t\tdelay += midiAudioContext.currentTime;\n\t\t}\n\n\t\tvar source = midiAudioContext.createBufferSource();\n\t\tsource.buffer = buffer;\n\n\t\t/// add gain + pitchShift\n\t\tvar gain = (velocity / 127) * (masterVolume / 127) * 2 - 1;\n\t\tsource.connect(midiAudioContext.destination);\n\t\tsource.playbackRate.value = 1; // pitch shift\n\t\tsource.gainNode = midiAudioContext.createGain(); // gain\n\t\tsource.gainNode.connect(midiAudioContext.destination);\n\t\tsource.gainNode.gain.value = Math.min(1.0, Math.max(-1.0, gain));\n\t\tsource.connect(source.gainNode);\n\t\tsource.start(delay || 0);\n\n\t\tsources[channelId + 'x' + noteId] = source;\n\n\t\treturn source;\n\t};\n\n\tmidi.noteOff = function(channelId, noteId, delay) {\n\t\tdelay = delay || 0;\n\n\t\t/// check whether the note exists\n\t\tvar channel = MIDI.channels[channelId];\n\t\tvar instrument = channel.program;\n\t\tvar bufferId = instrument + 'x' + noteId;\n\t\tvar buffer = audioBuffers[bufferId];\n\t\tif (buffer) {\n\t\t\tif (delay < midiAudioContext.currentTime) {\n\t\t\t\tdelay += midiAudioContext.currentTime;\n\t\t\t}\n\t\t\t///\n\t\t\tvar source = sources[channelId + 'x' + noteId];\n\t\t\tif (source) {\n\t\t\t\tif (source.gainNode) {\n\t\t\t\t\t// @Miranet: 'the values of 0.2 and 0.3 could of course be used as\n\t\t\t\t\t// a 'release' parameter for ADSR like time settings.'\n\t\t\t\t\t// add { 'metadata': { release: 0.3 } } to soundfont files\n\t\t\t\t\tvar gain = source.gainNode.gain;\n\t\t\t\t\tgain.linearRampToValueAtTime(gain.value, delay);\n\t\t\t\t\tgain.linearRampToValueAtTime(-1.0, delay + 0.3);\n\t\t\t\t}\n\n\t\t\t\tif (source.noteOff) {\n\t\t\t\t\tsource.noteOff(delay + 0.5);\n\t\t\t\t} else {\n\t\t\t\t\tsource.stop(delay + 0.5);\n\t\t\t\t}\n\n\t\t\t\tdelete sources[channelId + 'x' + noteId];\n\n\t\t\t\treturn source;\n\t\t\t}\n\t\t}\n\t};\n\n\tmidi.connect = function() {\n\t\t// TODO WFH This is insane.\n\t\tfor (var key in midi) {\n\t\t\tMIDI[key] = midi[key];\n\t\t}\n\n\t\tmidiAudioContext = new window.AudioContext();\n\n\t\tvar keyURLs = [];\n\t\tvar notes = MIDI.keyToNote;\n\t\tfor (var key in notes) {\n\t\t\tkeyURLs.push(key);\n\t\t}\n\n\t\tfunction waitForEnd(instrument) {\n\t\t\tfor (var key in bufferPending) { // has pending items\n\t\t\t\tif (bufferPending[key]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tfunction requestAudio(soundfont, programId, index, key) {\n\t\t\tvar keyURL = soundfont[key];\n\t\t\tif (!keyURL) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbufferPending[programId] ++;\n\n\t\t\tloadAudio(keyURL).then((buffer) => {\n\t\t\t\tbuffer.id = key;\n\t\t\t\tvar noteId = MIDI.keyToNote[key];\n\t\t\t\taudioBuffers[programId + 'x' + noteId] = buffer;\n\n\t\t\t\tif (--bufferPending[programId] === 0) {\n\t\t\t\t\tsoundfont.isLoaded = true;\n\t\t\t\t\twaitForEnd(instrument);\n\t\t\t\t}\n\t\t\t}).catch(() => {\n\t\t\t\tconsole.error('audio could not load', arguments);\n\t\t\t});\n\t\t};\n\t\t///\n\t\tvar bufferPending = {};\n\n\t\tvar soundfonts = MIDI.Soundfont;\n\t\tfor (var instrument in soundfonts) {\n\t\t\tvar soundfont = soundfonts[instrument];\n\t\t\tif (soundfont.isLoaded) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst spec = {\n\t\t\t\tid:      'tuba',\n\t\t\t\tname:    'Tuba',\n\t\t\t\tprogram:  58,\n\t\t\t};\n\n\t\t\tbufferPending[spec.program] = 0;\n\n\t\t\tfor (var index = 0; index < keyURLs.length; index++) {\n\t\t\t\trequestAudio(soundfont, spec.program, index, keyURLs[index]);\n\t\t\t}\n\n\t\t\tconsole.log(MIDI.keyToNote);\n\t\t}\n\t\t///\n\t\tsetTimeout(waitForEnd, 1);\n\t};\n\n\tfunction loadAudio(url) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tvar base64 = url.split(',')[1];\n\t\t\tvar buffer = Base64Binary.decodeArrayBuffer(base64);\n\t\t\tmidiAudioContext.decodeAudioData(buffer, resolve, reject);\n\t\t});\n\t};\n})();\n"]}