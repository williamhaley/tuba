{"version":3,"sources":["midi.js","app.js"],"names":["spec","id","name","program","Base64Binary","_keyStr","decodeArrayBuffer","base64String","bytes","Math","ceil","length","arrayBuffer","ArrayBuffer","decode","lkey1","indexOf","charAt","lkey2","chr1","chr2","chr3","enc1","enc2","enc3","enc4","i","j","uarray","Uint8Array","replace","MIDI","Soundfont","Context","contextMethods","proto","prototype","instance","sourceProto","Object","getPrototypeOf","createBufferSource","noteOn","start","noteGrainOn","forEach","names","pop","window","AudioContext","keyToNote","memo","A0","C8","number2key","n","octave","channels","number","pitchBend","mute","mono","omni","solo","loadPlugin","opts","Promise","resolve","instrument","midi","connect","fetch","then","res","script","document","createElement","language","type","text","body","appendChild","catch","e","reject","audioContext","midiAudioContext","sources","audioBuffers","channelId","noteId","velocity","volume","channel","console","warn","bufferId","log","buffer","error","arguments","source","duration","gain","destination","playbackRate","value","gainNode","createGain","min","max","key","keyURLs","notes","push","waitForEnd","bufferPending","requestAudio","soundfont","programId","index","keyURL","base64","split","decodeAudioData","decodedBuffer","isLoaded","soundfonts","setTimeout"],"mappings":"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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7Qf;;;;;;AAEAiB,OAAOjB,IAAP,GAAc,eAAKA,IAAnB","file":"b2b3fa487330c5902ea92b4863c2371b.map","sourcesContent":["// Gets a URL referencing the asset.\nimport tubaAudioURL from './tuba-ogg.dat';\n\nconst spec = {\n  id:      'tuba',\n  name:    'Tuba',\n  program:  58,\n};\n\nvar Base64Binary = {\n  _keyStr : \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n\n  /* will return a  Uint8Array type */\n  decodeArrayBuffer: function(base64String) {\n    let bytes = Math.ceil((3 * base64String.length) / 4.0);\n\n    let arrayBuffer = new ArrayBuffer(bytes);\n\n    this.decode(base64String, arrayBuffer, bytes);\n\n    return arrayBuffer;\n  },\n\n  decode: function(base64String, arrayBuffer, bytes) {\n    //get last chars to see if are valid\n    var lkey1 = this._keyStr.indexOf(base64String.charAt(base64String.length-1));\n    var lkey2 = this._keyStr.indexOf(base64String.charAt(base64String.length-1));\n\n    if (lkey1 == 64) bytes--; //padding chars, so skip\n    if (lkey2 == 64) bytes--; //padding chars, so skip\n\n    var chr1, chr2, chr3;\n    var enc1, enc2, enc3, enc4;\n    var i = 0;\n    var j = 0;\n\n    let uarray = new Uint8Array(arrayBuffer);\n\n    base64String = base64String.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\n    // TODO WFH Ah, this may explain our 3 * x / 4\n    for (i=0; i<bytes; i+=3) {\n      //get the 3 octects in 4 ascii chars\n      enc1 = this._keyStr.indexOf(base64String.charAt(j++));\n      enc2 = this._keyStr.indexOf(base64String.charAt(j++));\n      enc3 = this._keyStr.indexOf(base64String.charAt(j++));\n      enc4 = this._keyStr.indexOf(base64String.charAt(j++));\n\n      chr1 = (enc1 << 2) | (enc2 >> 4);\n      chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n      chr3 = ((enc3 & 3) << 6) | enc4;\n\n      uarray[i] = chr1;\n      if (enc3 != 64) uarray[i+1] = chr2;\n      if (enc4 != 64) uarray[i+2] = chr3;\n    }\n\n    return uarray;\n  }\n};\n\nlet MIDI = { Soundfont: {} };\n\n(function (Context) {\n  var contextMethods = [\n    [\"createGainNode\", \"createGain\"],\n    [\"createDelayNode\", \"createDelay\"],\n    [\"createJavaScriptNode\", \"createScriptProcessor\"]\n  ];\n\n  let proto = Context.prototype;\n  let instance = new Context();\n  let sourceProto = Object.getPrototypeOf(instance.createBufferSource());\n\n  if (typeof sourceProto.noteOn !== 'function') {\n    sourceProto.noteOn = sourceProto.start;\n  }\n\n  if (typeof sourceProto.noteGrainOn !== 'function') {\n    sourceProto.noteGrainOn = sourceProto.start;\n  }\n\n  contextMethods.forEach(function (names) {\n    while (names.length) {\n      let name = names.pop();\n\n      this[names.pop()] = this[name];\n    }\n  }, proto);\n})(window.AudioContext);\n\n// C8  == 108\nlet keyToNote = (function(memo = {}) {\n  var A0 = 0x15; // first note\n  var C8 = 0x6C; // last note\n\n  var number2key = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];\n\n  for (var n = A0; n <= C8; n++) {\n    var octave = (n - 12) / 12 >> 0;\n    var name = number2key[n % 12] + octave;\n\n    memo[name] = n;\n  }\n\n  return memo;\n})();\n\nlet channels = (function(memo = {}) {\n  for (var number = 0; number <= 15; number++) {\n    memo[number] = {\n      number:    number,\n      program:   number,\n      pitchBend: 0,\n      mute:      false,\n      mono:      false,\n      omni:      false,\n      solo:      false\n    };\n  }\n\n  return memo;\n})();\n\nMIDI.loadPlugin = function(opts = {}) {\n  return new Promise((resolve) => {\n    if (MIDI.Soundfont[opts.instrument]) {\n      midi.connect(opts);\n\n      return resolve();\n    }\n\n    fetch(tubaAudioURL).then(function (res) {\n      let script = document.createElement('script');\n      script.language = 'javascript';\n      script.type = 'text/javascript';\n      res.text().then((text) => {\n        script.text = text;\n        document.body.appendChild(script);\n\n        midi.connect(opts);\n\n        resolve();\n      });\n    }).catch(function (e) {\n      reject();\n    });\n  });\n};\n\nlet midi = (function(midi = {}) {\n  var audioContext = null;\n  var midiAudioContext;\n  var sources = {};\n  var audioBuffers = {};\n\n  midi.noteOn = function(channelId, noteId, velocity, volume) {\n    var channel = channels[channelId];\n    var instrument = channel.program;\n\n    instrument = spec.program;\n    console.warn(`overriding instrument id: ${instrument}`);\n\n    var bufferId = instrument + 'x' + noteId;\n\n    console.log(`bufferId: ${bufferId}`);\n\n    var buffer = audioBuffers[bufferId];\n    if (!buffer) {\n      console.error('no buffer', arguments);\n\n      return;\n    }\n\n    var source = midiAudioContext.createBufferSource();\n\n    source.buffer = buffer;\n\n    console.log(`note duration: ${source.buffer.duration}`);\n\n    var gain = (velocity / 127) * (volume / 127) * 2 - 1;\n\n    console.log(`gain: ${gain}`);\n\n    source.connect(midiAudioContext.destination);\n    source.playbackRate.value = 1;\n    source.gainNode = midiAudioContext.createGain();\n    source.gainNode.connect(midiAudioContext.destination);\n    source.gainNode.gain.value = Math.min(1.0, Math.max(-1.0, gain));\n    source.connect(source.gainNode);\n\n    source.start();\n\n    sources[channelId + 'x' + noteId] = source;\n\n    return source;\n  };\n\n  midi.connect = function() {\n    // TODO WFH This is insane.\n    for (var key in midi) {\n      console.log(key);\n      MIDI[key] = midi[key];\n    }\n\n    midiAudioContext = new window.AudioContext();\n\n    var keyURLs = [];\n    var notes = keyToNote;\n    for (var key in notes) {\n      keyURLs.push(key);\n    }\n\n    function waitForEnd(instrument) {\n      for (var key in bufferPending) { // has pending items\n        if (bufferPending[key]) {\n          return;\n        }\n      }\n    };\n\n    function requestAudio(soundfont, programId, index, key) {\n      var keyURL = soundfont[key];\n      if (!keyURL) {\n        return;\n      }\n\n      bufferPending[programId] ++;\n\n      var base64 = keyURL.split(',')[1];\n      var buffer = Base64Binary.decodeArrayBuffer(base64);\n\n      midiAudioContext.decodeAudioData(buffer).then((decodedBuffer) => {\n        decodedBuffer.id = key;\n        var noteId = keyToNote[key];\n        audioBuffers[programId + 'x' + noteId] = decodedBuffer;\n\n        if (--bufferPending[programId] === 0) {\n          soundfont.isLoaded = true;\n          waitForEnd(instrument);\n        }\n      }).catch(() => {\n        console.error('audio could not load', arguments);\n      });\n    };\n\n    var bufferPending = {};\n\n    var soundfonts = MIDI.Soundfont;\n\n    for (var instrument in soundfonts) {\n      var soundfont = soundfonts[instrument];\n      if (soundfont.isLoaded) {\n        continue;\n      }\n\n      bufferPending[spec.program] = 0;\n\n      for (var index = 0; index < keyURLs.length; index++) {\n        requestAudio(soundfont, spec.program, index, keyURLs[index]);\n      }\n    }\n\n    setTimeout(waitForEnd, 1);\n  };\n\n  return midi;\n})();\n\nexport default {\n    MIDI,\n};\n","import MIDI from './midi';\n\nwindow.MIDI = MIDI.MIDI;\n"]}